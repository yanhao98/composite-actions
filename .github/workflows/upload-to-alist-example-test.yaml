name: Upload to Alist Example

on:
  pull_request:
    paths:
      - "upload-to-alist/**"
      - ".github/workflows/upload-to-alist-example-test.yaml"
  push:
    paths:
      - "upload-to-alist/**"
      - ".github/workflows/upload-to-alist-example-test.yaml"

env:
  TZ: Asia/Shanghai

jobs:
  upload:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v5

      - name: ðŸ“ ç”Ÿæˆæž„å»ºäº§ç‰©çš„æ–‡ä»¶å
        id: filename
        run: |
          PROJECT_NAME=$(echo ${{ github.repository }} | cut -d'/' -f2)
          DATE=$(date '+%Y%m%d_%H%M')
          SHORT_HASH=$(git rev-parse --short HEAD)

          FILENAME="${PROJECT_NAME}_${DATE}_${SHORT_HASH}.txt"
          echo "ðŸ“ ç”Ÿæˆçš„æ–‡ä»¶å: $FILENAME"
          echo "FILENAME=${FILENAME}" >> $GITHUB_OUTPUT

      - name: Create test file
        run: |
          cat > ${{ steps.filename.outputs.FILENAME }} << EOF
          # æµ‹è¯•æ–‡ä»¶
          
          - é¡¹ç›®: ${{ github.repository }}
          - åˆ†æ”¯: ${{ github.ref_name }}
          - æäº¤: $(git rev-parse HEAD)
          - æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S %Z')
          - è§¦å‘äº‹ä»¶: ${{ github.event_name }}
          EOF

      - uses: yanhao98/composite-actions/upload-to-alist@main
        with:
          alist_url: ${{ vars.ALIST_URL }}
          alist_username: ${{ secrets.ALIST_USERNAME }}
          alist_password: ${{ secrets.ALIST_PASSWORD }}
          alist_target: ${{ vars.alist_target_base }}/github-actions/upload-to-alist/${{ steps.filename.outputs.FILENAME }}
          file: ${{ steps.filename.outputs.FILENAME }}